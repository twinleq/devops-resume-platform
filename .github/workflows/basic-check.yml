name: Basic Project Check

on:
  push:
    branches: [ main ]
  pull_request:
    branches: [ main ]
  workflow_dispatch:

jobs:
  # Basic File Check
  file-check:
    name: Basic File Check
    runs-on: ubuntu-latest
    steps:
    - name: Checkout code
      uses: actions/checkout@v4

    - name: Check project structure
      run: |
        echo "Checking project structure..."
        if [ -f "app/src/index.html" ]; then
          echo "✅ Frontend HTML found"
        else
          echo "❌ Frontend HTML missing"
          exit 1
        fi
        
        if [ -f "app/src/styles.css" ]; then
          echo "✅ Frontend CSS found"
        else
          echo "❌ Frontend CSS missing"
          exit 1
        fi
        
        if [ -f "app/src/script.js" ]; then
          echo "✅ Frontend JS found"
        else
          echo "❌ Frontend JS missing"
          exit 1
        fi
        
        if [ -f "backend/server.js" ]; then
          echo "✅ Backend server found"
        else
          echo "❌ Backend server missing"
          exit 1
        fi
        
        if [ -f "backend/package.json" ]; then
          echo "✅ Backend package.json found"
        else
          echo "❌ Backend package.json missing"
          exit 1
        fi

    - name: Check Docker files
      run: |
        echo "Checking Docker files..."
        if [ -f "app/Dockerfile" ]; then
          echo "✅ App Dockerfile found"
        fi
        if [ -f "backend/Dockerfile" ]; then
          echo "✅ Backend Dockerfile found"
        fi
        if [ -f "docker-compose-full.yml" ]; then
          echo "✅ Docker Compose found"
        fi

    - name: Check configuration files
      run: |
        echo "Checking configuration files..."
        if [ -f "README.md" ]; then
          echo "✅ README found"
        fi
        if [ -f "nginx/nginx-full.conf" ]; then
          echo "✅ Nginx config found"
        fi

  # Docker Build Test (Optional)
  docker-build-test:
    name: Docker Build Test
    runs-on: ubuntu-latest
    needs: file-check
    if: github.ref == 'refs/heads/main'
    steps:
    - name: Checkout code
      uses: actions/checkout@v4

    - name: Set up Docker Buildx
      uses: docker/setup-buildx-action@v3

    - name: Test docker-compose config
      run: |
        echo "Testing docker-compose configuration..."
        docker-compose -f docker-compose-full.yml config
        echo "✅ Docker Compose configuration is valid"

    - name: Build Test Summary
      run: |
        echo "## 🚀 Build Test Summary" >> $GITHUB_STEP_SUMMARY
        echo "- ✅ File structure validated" >> $GITHUB_STEP_SUMMARY
        echo "- ✅ Docker configuration validated" >> $GITHUB_STEP_SUMMARY
        echo "- 🌐 Site: https://romadanovsky.ru" >> $GITHUB_STEP_SUMMARY
        echo "- 📊 Grafana: https://romadanovsky.ru:3000" >> $GITHUB_STEP_SUMMARY
        echo "- 📈 Prometheus: https://romadanovsky.ru:9090" >> $GITHUB_STEP_SUMMARY
