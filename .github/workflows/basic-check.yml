name: Basic Project Check

on:
  push:
    branches: [ main ]
  pull_request:
    branches: [ main ]
  workflow_dispatch:

jobs:
  # Basic File Check
  file-check:
    name: Basic File Check
    runs-on: ubuntu-latest
    steps:
    - name: Checkout code
      uses: actions/checkout@v4

    - name: Check project structure
      run: |
        echo "Checking project structure..."
        if [ -f "app/src/index.html" ]; then
          echo "âœ… Frontend HTML found"
        else
          echo "âŒ Frontend HTML missing"
          exit 1
        fi
        
        if [ -f "app/src/styles.css" ]; then
          echo "âœ… Frontend CSS found"
        else
          echo "âŒ Frontend CSS missing"
          exit 1
        fi
        
        if [ -f "app/src/script.js" ]; then
          echo "âœ… Frontend JS found"
        else
          echo "âŒ Frontend JS missing"
          exit 1
        fi
        
        if [ -f "backend/server.js" ]; then
          echo "âœ… Backend server found"
        else
          echo "âŒ Backend server missing"
          exit 1
        fi
        
        if [ -f "backend/package.json" ]; then
          echo "âœ… Backend package.json found"
        else
          echo "âŒ Backend package.json missing"
          exit 1
        fi

    - name: Check Docker files
      run: |
        echo "Checking Docker files..."
        if [ -f "app/Dockerfile" ]; then
          echo "âœ… App Dockerfile found"
        fi
        if [ -f "backend/Dockerfile" ]; then
          echo "âœ… Backend Dockerfile found"
        fi
        if [ -f "docker-compose-full.yml" ]; then
          echo "âœ… Docker Compose found"
        fi

    - name: Check configuration files
      run: |
        echo "Checking configuration files..."
        if [ -f "README.md" ]; then
          echo "âœ… README found"
        fi
        if [ -f "nginx/nginx-full.conf" ]; then
          echo "âœ… Nginx config found"
        fi

  # Docker Build Test (Optional)
  docker-build-test:
    name: Docker Build Test
    runs-on: ubuntu-latest
    needs: file-check
    if: github.ref == 'refs/heads/main'
    steps:
    - name: Checkout code
      uses: actions/checkout@v4

    - name: Set up Docker Buildx
      uses: docker/setup-buildx-action@v3

    - name: Test docker-compose config
      run: |
        echo "Testing docker-compose configuration..."
        docker-compose -f docker-compose-full.yml config
        echo "âœ… Docker Compose configuration is valid"

    - name: Build Test Summary
      run: |
        echo "## ðŸš€ Build Test Summary" >> $GITHUB_STEP_SUMMARY
        echo "- âœ… File structure validated" >> $GITHUB_STEP_SUMMARY
        echo "- âœ… Docker configuration validated" >> $GITHUB_STEP_SUMMARY
        echo "- ðŸŒ Site: https://romadanovsky.ru" >> $GITHUB_STEP_SUMMARY
        echo "- ðŸ“Š Grafana: https://romadanovsky.ru:3000" >> $GITHUB_STEP_SUMMARY
        echo "- ðŸ“ˆ Prometheus: https://romadanovsky.ru:9090" >> $GITHUB_STEP_SUMMARY
